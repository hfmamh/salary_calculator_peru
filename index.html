<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Sueldo Neto - Per칰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 650px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="date"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: white;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        small {
            color: #999;
            font-size: 0.85em;
            display: block;
            margin-top: 5px;
        }

        .deductions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .deductions h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .deduction-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #666;
        }

        .deduction-item:last-child {
            margin-bottom: 0;
        }

        .result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .result-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .breakdown {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #666;
        }

        .breakdown-item.total {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>游눯 Calculadora de Sueldo Neto</h1>
        <p class="subtitle">Calcula tu sueldo neto seg칰n el sistema tributario peruano</p>
        
        <form id="salaryForm">
            <div class="form-group">
                <label for="grossSalary">Sueldo Bruto (mensual)</label>
                <input 
                    type="number" 
                    id="grossSalary" 
                    placeholder="Ingresa tu sueldo bruto mensual"
                    min="0"
                    step="0.01"
                    required
                >
            </div>

            <div class="form-group">
                <label for="healthInsurance">Tipo de Seguro de Salud</label>
                <select id="healthInsurance" required>
                    <option value="essalud">EsSalud (9%)</option>
                    <option value="eps">EPS (6.75%)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="startDate">Fecha de Inicio de Trabajo</label>
                <input 
                    type="date" 
                    id="startDate" 
                    required
                >
                <small>Se calcular치n autom치ticamente los meses y d칤as trabajados</small>
            </div>

            <div class="form-group">
                <label for="monthsFirstSemester">Meses trabajados (Enero - Junio)</label>
                <input 
                    type="number" 
                    id="monthsFirstSemester" 
                    placeholder="Se calcula autom치ticamente"
                    min="0"
                    max="6"
                    step="1"
                    readonly
                >
                <small>Gratificaci칩n de Julio (calculado autom치ticamente)</small>
            </div>

            <div class="form-group">
                <label for="monthsSecondSemester">Meses trabajados (Julio - Diciembre)</label>
                <input 
                    type="number" 
                    id="monthsSecondSemester" 
                    placeholder="Se calcula autom치ticamente"
                    min="0"
                    max="6"
                    step="1"
                    readonly
                >
                <small>Gratificaci칩n de Diciembre (calculado autom치ticamente)</small>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 1.1em;">CTS (Compensaci칩n por Tiempo de Servicios)</h3>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="ctsMonthsFirst">Meses completos (Noviembre - Abril)</label>
                    <input 
                        type="number" 
                        id="ctsMonthsFirst" 
                        placeholder="Se calcula autom치ticamente"
                        min="0"
                        max="6"
                        step="1"
                        readonly
                    >
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="ctsDaysFirst">D칤as adicionales (Noviembre - Abril)</label>
                    <input 
                        type="number" 
                        id="ctsDaysFirst" 
                        placeholder="Se calcula autom치ticamente"
                        min="0"
                        max="29"
                        step="1"
                        readonly
                    >
                    <small>CTS de Mayo (calculado autom치ticamente)</small>
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="ctsMonthsSecond">Meses completos (Mayo - Octubre)</label>
                    <input 
                        type="number" 
                        id="ctsMonthsSecond" 
                        placeholder="Se calcula autom치ticamente"
                        min="0"
                        max="6"
                        step="1"
                        readonly
                    >
                </div>
                
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="ctsDaysSecond">D칤as adicionales (Mayo - Octubre)</label>
                    <input 
                        type="number" 
                        id="ctsDaysSecond" 
                        placeholder="Se calcula autom치ticamente"
                        min="0"
                        max="29"
                        step="1"
                        readonly
                    >
                    <small>CTS de Noviembre (calculado autom치ticamente)</small>
                </div>
            </div>

            <div class="form-group">
                <label for="additionalIncome">Ingresos Adicionales Anuales (opcional)</label>
                <input 
                    type="number" 
                    id="additionalIncome" 
                    placeholder="Ej: bonos, comisiones, etc."
                    min="0"
                    step="0.01"
                    value="0"
                >
                <small>Solo afecta al c치lculo del impuesto de 5ta categor칤a (no afecta AFP, gratificaciones ni CTS)</small>
            </div>

            <div class="form-group">
                <label for="deductibleExpenses">Gastos Deducibles Anuales (opcional)</label>
                <input 
                    type="number" 
                    id="deductibleExpenses" 
                    placeholder="Ej: 6,000 (m치ximo 3 UIT = S/ 15,450)"
                    min="0"
                    step="0.01"
                    value="0"
                >
                <small>M치ximo: 3 UIT = S/ 15,450.00 (30% de alquileres pagados)</small>
            </div>

            <button type="submit" class="calculate-btn">Calcular Sueldo Neto</button>
        </form>

        <div id="result" style="display: none;">
            <div class="result">
                <div class="result-label">Tu Sueldo Neto Mensual</div>
                <div class="result-value" id="netSalaryValue">S/ 0.00</div>
            </div>

            <div class="breakdown">
                <div class="breakdown-item">
                    <span>Sueldo Bruto Mensual:</span>
                    <span id="grossDisplay">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>AFP (10%):</span>
                    <span id="afpDeduction">-S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Renta de 5ta Categor칤a (mensual):</span>
                    <span id="taxDeduction">-S/ 0.00</span>
                </div>
                <div class="breakdown-item total">
                    <span>Sueldo Neto Mensual:</span>
                    <span id="netDisplay">S/ 0.00</span>
                </div>
            </div>

            <div class="breakdown" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 1em;">Gratificaciones Anuales</h3>
                <div class="breakdown-item">
                    <span>Gratificaci칩n de Julio:</span>
                    <span id="gratificacionJuly">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Gratificaci칩n de Diciembre:</span>
                    <span id="gratificacionDecember">S/ 0.00</span>
                </div>
                <div class="breakdown-item total">
                    <span>Total Gratificaciones Anuales:</span>
                    <span id="totalGratificaciones">S/ 0.00</span>
                </div>
            </div>

            <div class="breakdown" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 1em;">CTS Anual</h3>
                <div class="breakdown-item">
                    <span>CTS de Mayo:</span>
                    <span id="ctsMay">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>CTS de Noviembre:</span>
                    <span id="ctsNovember">S/ 0.00</span>
                </div>
                <div class="breakdown-item total">
                    <span>Total CTS Anual:</span>
                    <span id="totalCTS">S/ 0.00</span>
                </div>
            </div>

            <div class="breakdown" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 1em;">Desglose Anual (Renta de 5ta Categor칤a)</h3>
                <div class="breakdown-item">
                    <span>Sueldo Bruto Anual (12 meses):</span>
                    <span id="grossAnnualSalary">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Gratificaciones Anuales:</span>
                    <span id="gratificacionesInAnnual">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>CTS Anual:</span>
                    <span id="ctsInAnnual">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Ingresos Adicionales:</span>
                    <span id="additionalIncomeDisplay">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Ingresos Anuales Totales:</span>
                    <span id="annualIncome">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Menos 7 UIT:</span>
                    <span id="uitDeduction">-S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Menos Gastos Deducibles:</span>
                    <span id="expensesDeduction">-S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Base Imponible:</span>
                    <span id="taxableBase">S/ 0.00</span>
                </div>
                <div class="breakdown-item">
                    <span>Impuesto Anual Calculado:</span>
                    <span id="annualTax">S/ 0.00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const UIT_2024 = 5150.00; // Valor UIT 2024
        const AFP_RATE = 0.10; // 10%
        
        // Tax brackets for Renta de 5ta Categor칤a
        const TAX_BRACKETS = [
            { min: 0, max: 5 * UIT_2024, rate: 0.08 },      // 0-5 UIT: 8%
            { min: 5 * UIT_2024, max: 20 * UIT_2024, rate: 0.14 },  // 5-20 UIT: 14%
            { min: 20 * UIT_2024, max: 35 * UIT_2024, rate: 0.17 }, // 20-35 UIT: 17%
            { min: 35 * UIT_2024, max: 45 * UIT_2024, rate: 0.20 }, // 35-45 UIT: 20%
            { min: 45 * UIT_2024, max: Infinity, rate: 0.30 }        // M치s de 45 UIT: 30%
        ];

        const form = document.getElementById('salaryForm');
        const resultDiv = document.getElementById('result');
        const netSalaryValue = document.getElementById('netSalaryValue');
        const grossDisplay = document.getElementById('grossDisplay');
        const taxDeduction = document.getElementById('taxDeduction');
        const afpDeduction = document.getElementById('afpDeduction');
        const netDisplay = document.getElementById('netDisplay');
        const annualIncome = document.getElementById('annualIncome');
        const uitDeduction = document.getElementById('uitDeduction');
        const expensesDeduction = document.getElementById('expensesDeduction');
        const taxableBase = document.getElementById('taxableBase');
        const annualTax = document.getElementById('annualTax');
        const gratificacionJuly = document.getElementById('gratificacionJuly');
        const gratificacionDecember = document.getElementById('gratificacionDecember');
        const totalGratificaciones = document.getElementById('totalGratificaciones');
        const grossAnnualSalary = document.getElementById('grossAnnualSalary');
        const gratificacionesInAnnual = document.getElementById('gratificacionesInAnnual');
        const ctsMay = document.getElementById('ctsMay');
        const ctsNovember = document.getElementById('ctsNovember');
        const totalCTS = document.getElementById('totalCTS');
        const ctsInAnnual = document.getElementById('ctsInAnnual');
        const additionalIncomeDisplay = document.getElementById('additionalIncomeDisplay');

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-PE', {
                style: 'currency',
                currency: 'PEN',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function calculateProgressiveTax(taxableAmount) {
            let totalTax = 0;
            let remainingAmount = taxableAmount;

            for (let i = 0; i < TAX_BRACKETS.length && remainingAmount > 0; i++) {
                const bracket = TAX_BRACKETS[i];
                const bracketMin = bracket.min;
                const bracketMax = bracket.max === Infinity ? remainingAmount : bracket.max;
                
                if (taxableAmount > bracketMin) {
                    const taxableInBracket = Math.min(remainingAmount, bracketMax - bracketMin);
                    if (taxableInBracket > 0) {
                        totalTax += taxableInBracket * bracket.rate;
                        remainingAmount -= taxableInBracket;
                    }
                }
            }

            return totalTax;
        }

        function calculateGratificacion(grossMonthly, monthsWorked, healthInsuranceType) {
            if (monthsWorked <= 0) return 0;
            
            // Base calculation: (salary 칑 months) 칭 6
            const baseGratificacion = (grossMonthly * monthsWorked) / 6;
            
            // Add percentage based on health insurance
            let bonusRate = 0;
            if (healthInsuranceType === 'essalud') {
                bonusRate = 0.09; // 9% for EsSalud
            } else if (healthInsuranceType === 'eps') {
                bonusRate = 0.0675; // 6.75% for EPS
            }
            
            const bonus = baseGratificacion * bonusRate;
            return baseGratificacion + bonus;
        }

        function calculateCTS(grossMonthly, monthsWorked, daysWorked) {
            // CTS = [(Remuneraci칩n Computable / 12) x Meses Trabajados] + [(Remuneraci칩n Computable / 360) x D칤as Trabajados]
            const monthsPart = (grossMonthly / 12) * monthsWorked;
            const daysPart = (grossMonthly / 360) * daysWorked;
            return monthsPart + daysPart;
        }

        function calculateMonthsAndDays(startDate, endDate) {
            if (!startDate || !endDate) return { months: 0, days: 0 };
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            // If start date is after end date, return 0
            if (start > end) return { months: 0, days: 0 };
            
            // Normalize to start of day
            start.setHours(0, 0, 0, 0);
            end.setHours(0, 0, 0, 0);
            
            let months = 0;
            let days = 0;
            let currentDate = new Date(start);
            
            // Calculate complete months
            while (currentDate < end) {
                const nextMonth = new Date(currentDate);
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                
                if (nextMonth <= end) {
                    months++;
                    currentDate = new Date(nextMonth);
                } else {
                    break;
                }
            }
            
            // Calculate remaining days from currentDate to end
            const remainingDate = new Date(currentDate);
            while (remainingDate < end) {
                days++;
                remainingDate.setDate(remainingDate.getDate() + 1);
            }
            
            // Limit months to 6 for semesters
            months = Math.min(months, 6);
            
            // If days >= 30, convert to months (but keep remainder as days)
            if (days >= 30) {
                const extraMonths = Math.floor(days / 30);
                months = Math.min(months + extraMonths, 6);
                days = days % 30;
            }
            
            return { months: months, days: days };
        }

        function calculateWorkedTime() {
            const startDateInput = document.getElementById('startDate').value;
            if (!startDateInput) {
                // Reset all fields to 0
                document.getElementById('monthsFirstSemester').value = '';
                document.getElementById('monthsSecondSemester').value = '';
                document.getElementById('ctsMonthsFirst').value = '';
                document.getElementById('ctsDaysFirst').value = '';
                document.getElementById('ctsMonthsSecond').value = '';
                document.getElementById('ctsDaysSecond').value = '';
                return;
            }
            
            const startDate = new Date(startDateInput);
            const currentYear = new Date().getFullYear();
            
            // Gratificaci칩n Julio: Enero 1 - Junio 30
            const gratificacionJulioStart = new Date(currentYear, 0, 1); // Enero 1
            const gratificacionJulioEnd = new Date(currentYear, 5, 30); // Junio 30
            const actualStartJulio = startDate > gratificacionJulioStart ? startDate : gratificacionJulioStart;
            const timeJulio = calculateMonthsAndDays(actualStartJulio, gratificacionJulioEnd);
            
            // Gratificaci칩n Diciembre: Julio 1 - Diciembre 31
            const gratificacionDiciembreStart = new Date(currentYear, 6, 1); // Julio 1
            const gratificacionDiciembreEnd = new Date(currentYear, 11, 31); // Diciembre 31
            const actualStartDiciembre = startDate > gratificacionDiciembreStart ? startDate : gratificacionDiciembreStart;
            const timeDiciembre = calculateMonthsAndDays(actualStartDiciembre, gratificacionDiciembreEnd);
            
            // CTS Mayo: Noviembre 1 (a침o anterior) - Abril 30
            const ctsMayoStart = new Date(currentYear - 1, 10, 1); // Noviembre 1 a침o anterior
            const ctsMayoEnd = new Date(currentYear, 3, 30); // Abril 30
            const actualStartMayo = startDate > ctsMayoStart ? startDate : ctsMayoStart;
            const timeMayo = calculateMonthsAndDays(actualStartMayo, ctsMayoEnd);
            
            // CTS Noviembre: Mayo 1 - Octubre 31
            const ctsNoviembreStart = new Date(currentYear, 4, 1); // Mayo 1
            const ctsNoviembreEnd = new Date(currentYear, 9, 31); // Octubre 31
            const actualStartNoviembre = startDate > ctsNoviembreStart ? startDate : ctsNoviembreStart;
            const timeNoviembre = calculateMonthsAndDays(actualStartNoviembre, ctsNoviembreEnd);
            
            // Update form fields
            document.getElementById('monthsFirstSemester').value = timeJulio.months;
            document.getElementById('monthsSecondSemester').value = timeDiciembre.months;
            document.getElementById('ctsMonthsFirst').value = timeMayo.months;
            document.getElementById('ctsDaysFirst').value = timeMayo.days;
            document.getElementById('ctsMonthsSecond').value = timeNoviembre.months;
            document.getElementById('ctsDaysSecond').value = timeNoviembre.days;
        }

        function calculateNetSalary() {
            // First, calculate worked time if start date is provided
            calculateWorkedTime();
            
            const grossMonthly = parseFloat(document.getElementById('grossSalary').value);
            const healthInsurance = document.getElementById('healthInsurance').value;
            const monthsFirstSemester = parseInt(document.getElementById('monthsFirstSemester').value) || 0;
            const monthsSecondSemester = parseInt(document.getElementById('monthsSecondSemester').value) || 0;
            const ctsMonthsFirst = parseInt(document.getElementById('ctsMonthsFirst').value) || 0;
            const ctsDaysFirst = parseInt(document.getElementById('ctsDaysFirst').value) || 0;
            const ctsMonthsSecond = parseInt(document.getElementById('ctsMonthsSecond').value) || 0;
            const ctsDaysSecond = parseInt(document.getElementById('ctsDaysSecond').value) || 0;
            const additionalIncomeAnnual = parseFloat(document.getElementById('additionalIncome').value) || 0;
            const deductibleExpensesAnnual = parseFloat(document.getElementById('deductibleExpenses').value) || 0;

            if (isNaN(grossMonthly) || grossMonthly < 0) {
                alert('Por favor ingresa un sueldo bruto v치lido');
                return;
            }

            // Calculate gratificaciones
            const gratificacionJulio = calculateGratificacion(grossMonthly, monthsFirstSemester, healthInsurance);
            const gratificacionDiciembre = calculateGratificacion(grossMonthly, monthsSecondSemester, healthInsurance);
            const totalGratificacionesAnual = gratificacionJulio + gratificacionDiciembre;

            // Calculate CTS
            const ctsMayo = calculateCTS(grossMonthly, ctsMonthsFirst, ctsDaysFirst);
            const ctsNoviembre = calculateCTS(grossMonthly, ctsMonthsSecond, ctsDaysSecond);
            const totalCTSAnual = ctsMayo + ctsNoviembre;

            // Calculate annual income (12 months salary + gratificaciones + CTS)
            const grossAnnualSalaryOnly = grossMonthly * 12;
            // For tax calculation, include additional income (bonos, comisiones, etc.)
            const grossAnnualForTax = grossAnnualSalaryOnly + totalGratificacionesAnual + totalCTSAnual + additionalIncomeAnnual;
            // For display purposes (without additional income in base salary)
            const grossAnnual = grossAnnualSalaryOnly + totalGratificacionesAnual + totalCTSAnual;

            // Step 1: Subtract 7 UIT (using grossAnnualForTax which includes additional income)
            const sevenUIT = 7 * UIT_2024;
            let taxableBaseAmount = grossAnnualForTax - sevenUIT;

            // Step 2: Subtract deductible expenses (max 3 UIT)
            const maxDeductibleExpenses = 3 * UIT_2024;
            const actualDeductibleExpenses = Math.min(deductibleExpensesAnnual, maxDeductibleExpenses);
            taxableBaseAmount = Math.max(0, taxableBaseAmount - actualDeductibleExpenses);

            // Step 3: Calculate progressive tax
            const annualTaxAmount = taxableBaseAmount > 0 ? calculateProgressiveTax(taxableBaseAmount) : 0;
            const monthlyTaxAmount = annualTaxAmount / 12;

            // Calculate AFP (10% of gross monthly)
            const afpAmount = grossMonthly * AFP_RATE;

            // Calculate net salary
            const netSalary = grossMonthly - afpAmount - monthlyTaxAmount;

            // Display results
            grossDisplay.textContent = formatCurrency(grossMonthly);
            afpDeduction.textContent = '-' + formatCurrency(afpAmount);
            taxDeduction.textContent = '-' + formatCurrency(monthlyTaxAmount);
            netDisplay.textContent = formatCurrency(netSalary);
            netSalaryValue.textContent = formatCurrency(netSalary);

            // Gratificaciones breakdown
            gratificacionJuly.textContent = formatCurrency(gratificacionJulio);
            gratificacionDecember.textContent = formatCurrency(gratificacionDiciembre);
            totalGratificaciones.textContent = formatCurrency(totalGratificacionesAnual);

            // CTS breakdown
            ctsMay.textContent = formatCurrency(ctsMayo);
            ctsNovember.textContent = formatCurrency(ctsNoviembre);
            totalCTS.textContent = formatCurrency(totalCTSAnual);

            // Annual breakdown
            grossAnnualSalary.textContent = formatCurrency(grossAnnualSalaryOnly);
            gratificacionesInAnnual.textContent = formatCurrency(totalGratificacionesAnual);
            ctsInAnnual.textContent = formatCurrency(totalCTSAnual);
            additionalIncomeDisplay.textContent = formatCurrency(additionalIncomeAnnual);
            annualIncome.textContent = formatCurrency(grossAnnualForTax);
            uitDeduction.textContent = '-' + formatCurrency(sevenUIT);
            expensesDeduction.textContent = '-' + formatCurrency(actualDeductibleExpenses);
            taxableBase.textContent = formatCurrency(taxableBaseAmount);
            annualTax.textContent = formatCurrency(annualTaxAmount);

            // Show result
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            calculateNetSalary();
        });

        // Auto-calculate on input change
        const inputs = document.querySelectorAll('input[type="number"], select');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (document.getElementById('grossSalary').value) {
                    calculateNetSalary();
                }
            });
            input.addEventListener('change', function() {
                if (document.getElementById('grossSalary').value) {
                    calculateNetSalary();
                }
            });
        });

        // Calculate worked time when start date changes
        const startDateInput = document.getElementById('startDate');
        startDateInput.addEventListener('change', function() {
            calculateWorkedTime();
            if (document.getElementById('grossSalary').value) {
                calculateNetSalary();
            }
        });
    </script>
</body>
</html>